"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
if (window['qg'] != null && window['qg'] != undefined) {
    var e = "[UMENG] -- ", t = function () { var t = null, n = !1; function i() { this.setDebug = function (e) { n = e; }; this.d = function () { if (n)
        try {
            "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
            console.log.apply(console, arguments);
        }
        catch (e) { } }; this.i = function () { try {
        if (n)
            try {
                "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
                console.log.apply(console, arguments);
            }
            catch (e) { }
    }
    catch (e) { } }; this.e = function () { if (n)
        try {
            "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
            console.log.apply(console, arguments);
        }
        catch (e) { } }; this.w = function () { if (n)
        try {
            "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
            console.log.apply(console, arguments);
        }
        catch (e) { } }; this.v = function () { if (n)
        try {
            "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
            console.log.apply(console, arguments);
        }
        catch (e) { } }; this.t = function () { if (n)
        try {
            console.log.apply(console, arguments);
        }
        catch (e) { } }; this.tip = function () { try {
        "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
        console.log.apply(console, arguments);
    }
    catch (e) { } }; this.tip_w = function (e) { try {
        console.log("%c [UMENG] -- " + e, "background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;");
    }
    catch (e) { } }; this.err = function () { try {
        "string" == typeof arguments[0] && (arguments[0] = e + arguments[0]);
        console.log.apply(console, arguments);
    }
    catch (e) { } }; this.repeat = function (e) { for (var t = e; t.length < 86;)
        t += e; return t; }; } return function () { null === t && (t = new i); return t; }; }(), n = function () { var e = null; function t() { var e = {}; this.useOpenid = function () { return !!e.useOpenid; }; this.useSwanid = function () { return !!e.useSwanid; }; this.autoGetOpenid = function () { return !!e.autoGetOpenid; }; this.appKey = function () { return e.appKey; }; this.uploadUserInfo = function () { return e.uploadUserInfo; }; this.enableVerify = function () { return e.enableVerify; }; this.set = function (t) { e = t; }; this.get = function () { return e; }; this.setItem = function (t, n) { e[t] = n; }; this.getItem = function (t) { return e[t]; }; } return function () { e || (e = new t); return e; }; }();
    function i() { }
    i.prototype = { on: function (e, t, n) { var i = this.e || (this.e = {}); (i[e] || (i[e] = [])).push({ fn: t, ctx: n }); return this; }, once: function (e, t, n) { var i = this; function r() { i.off(e, r); t.apply(n, arguments); } r._ = t; return this.on(e, r, n); }, emit: function (e) { for (var t = [].slice.call(arguments, 1), n = ((this.e || (this.e = {}))[e] || []).slice(), i = 0, r = n.length; i < r; i++)
            n[i].fn.apply(n[i].ctx, t); return this; }, off: function (e, t) { var n = this.e || (this.e = {}), i = n[e], r = []; if (i && t)
            for (var o = 0, s = i.length; o < s; o++)
                i[o].fn !== t && i[o].fn._ !== t && r.push(i[o]); r.length ? n[e] = r : delete n[e]; return this; } };
    var r = new i;
    r.messageType = { CONFIG_LOADED: 0, UMA_LIB_INITED: 1 };
    function o() { return qg; }
    var s = o();
    var a = new (function () { function e() { } e.prototype.setStorage = function (e, t, n) { if (s.setStorage)
        s.setStorage({ key: e, value: t, success: function () { "function" == typeof n && n(!0); }, fail: function () { "function" == typeof n && n(!1); } });
    else {
        localStorage.setItem(e, t);
        "function" == typeof n && n(!0);
    } }; e.prototype.getStorage = function (e, n) { if (s.getStorage)
        s.getStorage({ key: e, success: function (e) { "function" == typeof n && n(e); }, fail: function (i, r) { t().w(e + "code = : " + r); "function" == typeof n && n(); } });
    else if (localStorage) {
        var i = localStorage.getItem(e);
        "function" == typeof n && n(i);
    } }; e.prototype.removeStorage = function (e, t) { if (s.deleteStorage)
        s.deleteStorage({ key: e, success: function () { "function" == typeof t && t(!0); }, fail: function () { "function" == typeof t && t(!1); } });
    else if (localStorage) {
        localStorage.removeItem(e);
        "function" == typeof t && t(!0);
    } }; e.prototype.getSystemInfo = function (e) { s.getSystemInfo({ success: function (t) { var n = { model: t.model, brand: t.brand, screenWidth: t.screenWidth, screenHeight: t.screenHeight, platform: t.osType, pixelRatio: t.pixelRatio, platformVersion: t.platformVersionCode, language: t.language, deviceName: t.model, OSVersion: t.osVersionName, resolution: "", statusBarHeight: t.statusBarHeight }; if (t.system) {
            var i = t.system.split(" ");
            if (Array.isArray(i)) {
                !n.platform && (n.platform = i[0]);
                !n.OSVersion && (n.OSVersion = i[1]);
            }
        } var r = Math.round(t.screenWidth * t.pixelRatio), o = Math.round(t.screenHeight * t.pixelRatio); n.resolution = r > o ? r + "*" + o : o + "*" + r; "function" == typeof e && e(n); }, fail: function () { "function" == typeof e && e(); } }); }; e.prototype.getDeviceInfo = function (e) { "function" == typeof e && e(""); }; e.prototype.getNetworkInfo = function (e) { s.getNetworkType({ success: function (t) { "function" == typeof e && e({ networkAvailable: "none" !== t.networkType, networkType: t.networkType }); }, fail: function () { "function" == typeof e && e(); } }); }; e.prototype.request = function (e) { var t = e.success || function () { }, n = e.fail || function () { }, i = !1, r = null; e.success = function (e) { if (!i) {
        r && clearTimeout(r);
        "function" == typeof t && t(e);
    } }; e.fail = function () { if (!i) {
        r && clearTimeout(r);
        "function" == typeof n && n(!1);
    } }; s.request ? s.request(e) : XMLHttpRequest && function (e, t) { void 0 === t && (t = !0); (e = e || {}).method = e.method || "GET"; e.url = e.url || ""; e.success = e.success || function () { }; e.fail = e.fail || function () { }; var n, i, r = new XMLHttpRequest, o = []; if ("object" == typeof e.data) {
        for (var s in e.data)
            o.push(s + "=" + encodeURIComponent(e.data[s]));
        n = JSON.stringify(e.data || {});
        i = o.join("&");
    }
    else if ("string" == typeof e.data) {
        n = e.data;
        i = e.data;
    } "POST" === e.method ? r.open(e.method, e.url, t) : r.open(e.method, e.url + "?" + i || "", t); if (e.header && "object" == typeof e.header) {
        for (var a in e.header)
            r.setRequestHeader(a, e.header[a]);
        e.header["content-type"] || e.header["Content-Type"] || r.setRequestHeader("content-type", "text/plain");
    } t && (r.timeout = e.timeout || 3e4); r.onreadystatechange = function () { if (4 == r.readyState && 200 == r.status) {
        var t = {};
        try {
            t = JSON.parse(r.responseText);
        }
        catch (e) { }
        e.success({ data: t, status: r.status });
    }
    else
        4 == r.readyState && e.fail({ data: null, status: r.status }); }; "POST" === e.method ? r.send(n || "") : r.send(); }(e, !0); r = setTimeout((function () { r && clearTimeout(r); i = !0; "function" == typeof n && n(i); }), e.timeout || 3e4); }; e.prototype.getSdkType = function () { return this.getPlatform() + "mp"; }; e.prototype.getPlatform = function () { return "quickgame"; }; e.prototype.getUserInfo = function (e) { e && e(); }; e.prototype.getAppInfoSync = function () { return {}; }; e.prototype.onShareAppMessage = function (e) { }; e.prototype.shareAppMessage = function (e) { }; e.prototype.getContext = function () { return o(); }; e.prototype.getLaunchOptionsSync = function () { var e = null; if (e)
        return e; if (!s.getLaunchOptionsSync)
        return {}; try {
        e = s.getLaunchOptionsSync();
    }
    catch (t) {
        e = null;
    } return e || {}; }; return e; }()), u = function (e, t) { return (u = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t; } || function (e, t) { for (var n in t)
        t.hasOwnProperty(n) && (e[n] = t[n]); })(e, t); };
    function c(e, t) { u(e, t); function n() { this.constructor = e; } e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n); }
    var f = { SESSION_INTERVAL: 3e4, LOG_URL: "/quickgamem_logs", GET_OPENID_URL: "", USERINFO_URL: "/uminiprogram_logs/comm/uif", ENDPOINT: "https://umini.shujupie.com", ENDPOINTB: "https://ulogs.umeng.com", DEVICE_INFO_KEY: "device_info", ADVERTISING_ID: "mobile_ad_id", ANDROID_ID: "android_id", CURRENT_SESSION: "current_session", SESSION_PAUSE_TIME: "session_pause_time", EVENT_SEND_DEFAULT_INTERVAL: 15e3, EVENT_LAST_SEND_TIME: "last_send_time", MAX_EVENTID_LENGTH: 128, MAX_PROPERTY_KEY_LENGTH: 256, MAX_PROPERTY_KEYS_COUNT: 100, REPORT_POLICY: "report_policy", REPORT_INTERVAL_TIME: "report_interval_time", REPORT_POLICY_START_SEND: "1", REPORT_POLICY_INTERVAL: "6", IMPRINT: "imprint", SEED_VERSION: "1.0.0", IMPL_VERSION: "2.7.1", ALIPAY_AVAILABLE_VERSION: "10.1.52", SHARE_PATH: "um_share_path", SHARES: "shares", REQUESTS: "requests", UUID: "um_uuid", UUID_SUFFIX: "ud", OPENID: "um_od", UNIONID: "um_unid", ALIPAYID: "um_alipayid", USERID: "um_userid", PROVIDER: "um_provider", SWANID: "um_swanid", ANONYMOUSID: "um_anonymousid", LAUNCH_OPTIONS: "LAUNCH_OPTIONS", UM_SSRC: "_um_ssrc", USER_INFO: "user_info", IS_ALIYUN: !1 };
    var p, l = { isNumber: function (e) { return !Number.isNaN(parseInt(e, 10)); }, compareVersion: function (e, t) { for (var n = String(e).split("."), i = String(t).split("."), r = 0; r < Math.max(n.length, i.length); r++) {
            var o = parseInt(n[r] || 0, 10), s = parseInt(i[r] || 0, 10);
            if (o > s)
                return 1;
            if (o < s)
                return -1;
        } return 0; }, getRandomStr: function (e) { for (var t = "", n = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"], i = 0; i < Number(e); i++) {
            t += n[Math.round(Math.random() * (n.length - 1))];
        } return t; }, clone: function (e) { return JSON.parse(JSON.stringify(e)); }, startsWith: function (e, t) { return !(!e || !t || 0 === t.length || t.length > e.length) && e.substr(0, t.length) === t; }, endsWith: function (e, t) { return !(!t || 0 === e.length || t.length > e.length) && e.substring(e.length - t.length) === t; }, assign: function (e) { if (null == e)
            throw new TypeError("Cannot convert undefined or null to object"); for (var t = Object(e), n = 1; n < arguments.length; n++) {
            var i = arguments[n];
            if (i)
                for (var r in i)
                    Object.prototype.hasOwnProperty.call(i, r) && (t[r] = i[r]);
        } return t; }, deepEqual: function e(t, n) { if (t === n)
            return !0; if (t && "object" == typeof t && n && "object" == typeof n) {
            if (Object.keys(t).length !== Object.keys(n).length)
                return !1;
            for (var i in t) {
                if (Object.prototype.hasOwnProperty.call(n, i))
                    return !1;
                if (!e(t[i], n[i]))
                    return !1;
            }
            return !0;
        } return !1; }, trimStart: function (e, t) { if (!e)
            return ""; if ("string" == typeof t && t.length) {
            var n = new RegExp("^" + t + "*");
            e = e.replace(n, "");
        }
        else
            e = e.replace(/^s*/, ""); return e; }, trimEnd: function (e, t) { if (!e)
            return ""; var n, i; if ("string" == typeof t && t.length) {
            n = new RegExp(t);
            i = e.length;
            for (; n.test(e.charAt(i));)
                i -= 1;
            return e.slice(0, i + 1);
        } n = /s/; i = e.length - 1; for (; n.test(e.charAt(i));)
            i -= 1; return e.slice(0, i + 1); }, isFunction: function (e) { return "function" == typeof e; } }, d = function (e) { c(n, e); function n() { var t = null !== e && e.apply(this, arguments) || this; t._openid = ""; t._unionid = ""; t._useOpenid = !1; return t; } n.prototype.initID = function (e) { var n = this; n._idType = n._useOpenid ? "openid" : "uuid"; t().v("id type: ", n._idType); a.getStorage(f.UNIONID, (function (e) { n._unionid = e; })); this._useOpenid ? a.getStorage(f.OPENID, (function (t) { n._openid = t; e && e(); })) : e && e(); }; n.prototype.setUseOpenid = function (e) { this._useOpenid = e; }; n.prototype.setOpenid = function (e) { if (!this._openid && e) {
        this._openid = e;
        a.setStorage(f.OPENID, e);
    } }; n.prototype.setUnionid = function (e) { if (!this._unionid && e) {
        this._unionid = e;
        a.setStorage(f.UNIONID, e);
    } }; n.prototype.getIdTracking = function () { var t = e.prototype.getIdTracking.call(this); this._openid && (t.openid = this._openid); this._unionid && (t.unionid = this._unionid); this._userid && (t.userid = this._userid); return t; }; n.prototype.getId = function () { return this._useOpenid ? this._openid : this._uuid; }; return n; }(function () { function e() { this._uuid = ""; this._userid = ""; this._provider = ""; this._idType = ""; } e.prototype.createUUID = function () { return l.getRandomStr(10) + Date.now() + l.getRandomStr(7) + f.UUID_SUFFIX; }; e.prototype.initUUID = function (e) { var t = this; a.getStorage(f.UUID, (function (n) { if (n)
        t._uuid = n;
    else {
        t._uuid = t.createUUID();
        a.setStorage(f.UUID, t._uuid);
    } e && e(n); })); }; e.prototype.initUserid = function () { var e = this; a.getStorage(f.USERID, (function (n) { if (!e._userid && n) {
        e._userid = n;
        t().v("userId is ", n);
    } })); a.getStorage(f.PROVIDER, (function (n) { if (!e._provider && n) {
        e._provider = n;
        t().v("provider is ", n);
    } })); }; e.prototype.init = function (e) { var t = this; t.initUUID((function () { t.initUserid(); t.initID(e); })); }; e.prototype.setUserid = function (e, t) { if (!this._userid && e) {
        this._userid = e;
        this._provider = t;
        a.setStorage(f.USERID, e);
        a.setStorage(f.PROVIDER, t);
    } }; e.prototype.getUserId = function () { return this._userid; }; e.prototype.getProvider = function () { return this._provider; }; e.prototype.getIdType = function () { return this._idType; }; e.prototype.getIdTracking = function () { var e = {}; this._uuid && (e.uuid = this._uuid); this._userid && (e.userid = this._userid); return e; }; return e; }()), h = o(), g = function (e) { c(n, e); function n() { return null !== e && e.apply(this, arguments) || this; } n.prototype.getOpenIdAsync = function (e, n) { var i = this; h.login({ success: function (r) { r.code ? a.request({ url: f.ENDPOINT + f.GET_OPENID_URL, method: "GET", data: { key: e, code: r.code }, success: function (e) { if (e && 200 === e.statusCode && e.data && e.data.data) {
                var t = e.data.data;
                i.setOpenid(t.oid);
                i.setUnionid(t.uid);
                return n && n(!0);
            } n && n(); }, fail: function (e) { t().v("wx request failed...", e); n && n(); } }) : n && n(); }, fail: function () { n && n(); } }); }; return n; }(d), v = (p = null, function () { p || (p = new g); return p; }), _ = function () { var e = null; function t() { var e = !1, t = null, n = []; this.addPageStart = function (n) { if (n && !e) {
        t = { ts: Date.now(), path: n, page_name: n };
        e = !0;
    } }; this.addPageEnd = function (i) { if (e && i && t && i === t.page_name) {
        var r = Date.now() - t.ts;
        t.duration = Math.abs(r);
        n.push(t);
        t = null;
        e = !1;
    } }; this.get = function () { return n; }; this.getCurrentPage = function () { return t; }; this.clear = function () { n.length = 0; }; } return function () { e || (e = new t); return e; }; }(), y = {};
    var m = function () { var e = null, n = [], i = ""; function r() { return { add: function (e, r) { t().v("share origin: %o", e); var o = { title: e && e.title, path: e && e.path && e.path.split("?")[0], _um_sts: Date.now() }; o.path && o.path.length > 1 && l.startsWith(o.path, "/") && (o.path = l.trimStart(o.path, "/")); var s = e.path || "", a = v().getId(); if (a) {
            var u = i.split(","), c = (u = u.filter((function (e) { return e.length > 0; }))).indexOf(a);
            c >= 0 && (u = u.slice(0, c));
            u.length < 3 && u.push(a);
            var f = u.join(",");
            -1 !== s.indexOf("?") ? s += "&_um_ssrc=" + f : s += "?_um_ssrc=" + f;
            var p = Date.now();
            s += "&_um_sts=" + p;
            if (r) {
                var d = function (e) { var t = []; for (var n in e)
                    "_um_ssrc" !== n && "_um_sts" !== n && t.push(n + "=" + e[n]); return t.join("&"); }(y), h = d ? d + "&_um_ssrc=" + f + "&_um_sts=" + p : "_um_ssrc=" + f + "&_um_sts=" + p;
                e.query = e.query ? e.query + "&_um_ssrc=" + f + "&_um_sts=" + p : h;
            }
            else
                e.path = s;
            o._um_ssrc = f;
            o._um_sts = p;
        } n.push(o); t().v("share: %o", e); return e; }, setShareSource: function (e) { i = e; }, clear: function () { n.length = 0; }, get: function () { return n; } }; } return function () { e || (e = new r); return e; }; }(), S = function (e) { if (e)
        try {
            return JSON.stringify(e);
        }
        catch (e) { } return ""; }, I = function (e) { if (e)
        try {
            return JSON.parse(e);
        }
        catch (e) { } return null; }, O = function () { var e = null, t = "", i = null, r = !1; function o() { this.load = function (e) { if (i) {
        a.removeStorage(t);
        e();
    }
    else {
        t = "um_cache_" + n().appKey();
        a.getStorage(t, (function (n) { i = I(n) || {}; r = !0; a.removeStorage(t); e(); }));
    } }; this.save = function () { i && a.setStorage(t, S(i)); }; this.set = function (e, t) { i && (i[e] = t); }; this.get = function (e) { return (i || {})[e]; }; this.remove = function (e) { i && i[e] && delete i[e]; }; this.getAll = function () { return i; }; this.clear = function () { i = null; }; this.has = function (e) { return !!this.get(e); }; this.isLoaded = function () { return r; }; } return function () { e || (e = new o); return e; }; }(), E = function () { var e, n, i = [], r = []; function o() { if (i.length) {
        var e = O().get("ekvs");
        if (function (e) { var t = 0; for (var n in e)
            Array.isArray(e[n]) && (t += e[n].length); return t; }(e) + i.length <= 1e4) {
            e = s(e, i);
            O().set("ekvs", e);
        }
    } } function s(e, t) { var i = (e = e || {})[n]; Array.isArray(i) && i.length ? e[n] = i.concat(t) : e[n] = [].concat(t); return e; } return function () { e || (e = { addEvent: function (e) { if (n) {
            i.unshift(e);
            if (i.length > 1) {
                o();
                i.length = 0;
            }
        }
        else {
            t().w("session id is null: ", n);
            r.unshift(e);
        } }, setSessionId: function (e) { n = e; t().v("setSessionId: ", n); if (Array.isArray(r) && r.length && n) {
            for (var i = 0; i < r.length; i++)
                this.addEvent(r[i]);
            r.length = 0;
        } }, getEkvs: function () { var e = O().get("ekvs"); i && i.length && (e = s(e, i)); return e; }, clear: function () { O().remove("ekvs"); i.length = 0; } }); return e; }; }(), T = "2g", N = "3g", A = "4g", k = "half_session", b = "close_session", D = "ekv", w = ["access", "access_subtype"], R = function () { var e = null; function t() { var e = !1, t = {}; function i(e) { var i = O().get(f.IMPRINT); i && (t.imprint = i); t.device_type = "Phone"; t.sdk_version = f.IMPL_VERSION; t.appkey = n().appKey(); a.getDeviceInfo((function (e) { t.device_info = e || ""; })); var r = a.getAppInfoSync(); t.appid = r.appId; t.app_env = r.appEnv; t.app_version = r.appVersion; a.getSystemInfo((function (n) { a.getNetworkInfo((function (i) { var r = function (e, t) { var n = {}; (e = e || {}).safeArea = e.safeArea || {}; var i = (t = t || {}).networkType; "none" === i && (i = "unknown"); var r = e.model || "", o = e.platform || "", s = e.brand || "", u = s.toLowerCase(); n.sdk_type = a.getSdkType(); n.platform = a.getPlatform(); n.platform_sdk_version = e.platformSDKVersion; n.platform_version = e.platformVersion; n.resolution = e.resolution; n.pixel_ratio = e.pixelRatio; n.os = o; n.font_size_setting = e.fontSizeSetting; n.device_model = r; n.device_brand = s; n.device_manufacturer = u; n.device_manuid = r; n.device_name = r; n.os_version = e.OSVersion; n.language = e.language; n.theme = e.theme; n.benchmark_level = e.benchmarkLevel; n.status_bar_height = e.statusBarHeight; n.safe_area_top = e.safeArea.top; n.safe_area_left = e.safeArea.left; n.safe_area_right = e.safeArea.right; n.safe_area_bottom = e.safeArea.bottom; n.safe_area_height = e.safeArea.height; n.safe_area_width = e.safeArea.width; n.storage = e.storage; n.screen_width = e.screenWidth; n.screen_height = e.screenHeight; n.host = e.host; switch (i = i ? i.toLowerCase() : "") {
        case A:
            n.access_subtype = "LTE";
            n.access = "4G";
            break;
        case N:
            n.access_subtype = "CDMA";
            n.access = "3G";
            break;
        case T:
            n.access_subtype = "GRPS";
            n.access = "2G";
            break;
        default:
            n.access = i;
            delete n.access_subtype;
    } return n; }(n, i); l.assign(t, r); e && e(); })); })); } return { init: function () { i((function () { e = !0; })); }, isLoaded: function () { return e; }, get: function () { return t; }, getRealtimeFields: function () { var e = {}; w.forEach((function (n) { e[n] = t[n]; })); return e; }, setIdTracking: function (e) { this.setItem("id_tracking", e); }, setIdType: function (e) { this.setItem("id_type", e); }, setAppVersion: function (e) { this.setItem("app_version", e); }, setSuperProperty: function (e) { t.sp || (t.sp = {}); t.sp.isv = e; }, getSuperProperty: function () { return t && t.sp ? t.sp.isv : ""; }, setItem: function (e, n) { t[e] = n; }, getItem: function (e) { return t[e]; } }; } return { instance: function () { e || (e = t()); return e; } }; }(), U = function () { var e = null, n = null, i = null; function r() { return { resume: function (e) { var r = !1; i || (i = O().get(f.CURRENT_SESSION)); var o = new Date; n = o.getTime(); if (!i || !i.end_time || n - i.end_time > f.SESSION_INTERVAL) {
            r = !0;
            !function (e) { try {
                var n = (i || {}).options || {}, r = l.assign({}, function (e) { var n = {}; for (var i in e)
                    0 === i.indexOf("_um_") && (n[i] = e[i]); t().v("query: ", e); t().v("_um_params: ", n); return n; }(e.query));
                r.path = e.path || n.path;
                r.scene = e.scene ? a.getPlatform() + "_" + e.scene : n.scene;
                var o = e.referrerInfo;
                o && (r.referrerAppId = o.appId);
                t().v("session options: ", r);
                var s = r[f.UM_SSRC];
                s && m().setShareSource(s);
                var u = Date.now();
                i = { id: l.getRandomStr(10) + u, start_time: u, options: r };
            }
            catch (e) {
                t().e("生成新session失败: ", e);
            } }(e);
            t().v("开始新的session(%s): ", i.id, i);
        }
        else
            t().v("延续上一次session(%s): %s ", i.id, o.toLocaleTimeString(), i); return r; }, pause: function () { !function () { if (i) {
            var e = new Date;
            i.end_time = e.getTime();
            "number" != typeof i.duration && (i.duration = 0);
            i.duration = i.end_time - n;
            O().set(f.CURRENT_SESSION, i);
            t().v("退出会话(%s): %s ", i.id, e.toLocaleTimeString(), i);
        } }(); }, getCurrentSessionId: function () { return (i || {}).id; }, getCurrentSession: function () { return i; }, cloneCurrentSession: function () { return l.clone(i); } }; } return function () { e || (e = r()); return e; }; }();
    function P(e) { var t = null; switch (e) {
        case k:
            t = function () { var e = null, t = U().cloneCurrentSession(); t && (e = { header: { st: "1" }, analytics: { sessions: [t] } }); return e; }();
            break;
        case b:
            t = function () { var e = null, t = {}, n = U().cloneCurrentSession(); if (n) {
                var i = _().get(), r = m().get();
                Array.isArray(i) && i.length && (n.pages = l.clone(i));
                Array.isArray(r) && r.length && (n.shares = l.clone(r));
                _().clear();
                m().clear();
                t.sessions = [n];
            } var o = E().getEkvs(); if (o) {
                t.ekvs = l.clone(o);
                E().clear();
            } (t.sessions || t.ekvs) && (e = { analytics: t }); return e; }();
            break;
        case D: t = function () { var e = null, t = E().getEkvs(); if (t) {
            e = { analytics: { ekvs: l.clone(t) } };
            E().clear();
        } return e; }();
    } return t; }
    var C = { sessions: "sn", ekvs: "e", active_user: "active_user" }, L = { sdk_type: "sdt", access: "ac", access_subtype: "acs", device_model: "dm", language: "lang", device_type: "dt", device_manufacturer: "dmf", device_name: "dn", platform_version: "pv", id_type: "it", font_size_setting: "fss", os_version: "ov", device_manuid: "did", platform_sdk_version: "psv", device_brand: "db", appkey: "ak", _id: "id", id_tracking: "itr", imprint: "imp", sdk_version: "sv", resolution: "rl", testToken: "ttn", theme: "t5", benchmark_level: "bml", screen_width: "sw", screen_height: "sh", status_bar_height: "sbh", safe_area_top: "sat", safe_area_left: "sal", safe_area_right: "sar", safe_area_bottom: "sab", safe_area_height: "sah", safe_area_width: "saw", pixel_ratio: "pr", storage: "s7", host: "hs" }, M = { uuid: "ud", unionid: "und", openid: "od", anonymousid: "nd", alipay_id: "ad", device_id: "dd", userid: "puid" };
    function j(e, t) { var n = V(e, t); e && e.id_tracking && (n[t.id_tracking || "id_tracking"] = V(e.id_tracking, M)); return n; }
    function V(e, t) { var n = {}; for (var i in e)
        t[i] ? n[t[i]] = e[i] : n[i] = e[i]; return n; }
    function x(e, t) { var n = {}; if (e)
        for (var i in e)
            e[i] && (n[t[i]] = e[i]); return n; }
    var q = "";
    function G() { return q; }
    var F = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", H = function (e) { for (var t = {}, n = 0, i = e.length; n < i; n++)
        t[e.charAt(n)] = n; return t; }(F), K = String.fromCharCode, Y = function (e) { if (e.length < 2) {
        return (t = e.charCodeAt(0)) < 128 ? e : t < 2048 ? K(192 | t >>> 6) + K(128 | 63 & t) : K(224 | t >>> 12 & 15) + K(128 | t >>> 6 & 63) + K(128 | 63 & t);
    } var t = 65536 + 1024 * (e.charCodeAt(0) - 55296) + (e.charCodeAt(1) - 56320); return K(240 | t >>> 18 & 7) + K(128 | t >>> 12 & 63) + K(128 | t >>> 6 & 63) + K(128 | 63 & t); }, J = /[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g, X = function (e) { var t = [0, 2, 1][e.length % 3], n = e.charCodeAt(0) << 16 | (e.length > 1 ? e.charCodeAt(1) : 0) << 8 | (e.length > 2 ? e.charCodeAt(2) : 0); return [F.charAt(n >>> 18), F.charAt(n >>> 12 & 63), t >= 2 ? "=" : F.charAt(n >>> 6 & 63), t >= 1 ? "=" : F.charAt(63 & n)].join(""); }, B = function (e) { return function (e) { return e.replace(J, Y); }(e).replace(/[\s\S]{1,3}/g, X); }, W = new RegExp(["[À-ß][-¿]", "[à-ï][-¿]{2}", "[ð-÷][-¿]{3}"].join("|"), "g"), z = function (e) { switch (e.length) {
        case 4:
            var t = ((7 & e.charCodeAt(0)) << 18 | (63 & e.charCodeAt(1)) << 12 | (63 & e.charCodeAt(2)) << 6 | 63 & e.charCodeAt(3)) - 65536;
            return K(55296 + (t >>> 10)) + K(56320 + (1023 & t));
        case 3: return K((15 & e.charCodeAt(0)) << 12 | (63 & e.charCodeAt(1)) << 6 | 63 & e.charCodeAt(2));
        default: return K((31 & e.charCodeAt(0)) << 6 | 63 & e.charCodeAt(1));
    } }, Q = function (e) { var t = e.length, n = t % 4, i = (t > 0 ? H[e.charAt(0)] << 18 : 0) | (t > 1 ? H[e.charAt(1)] << 12 : 0) | (t > 2 ? H[e.charAt(2)] << 6 : 0) | (t > 3 ? H[e.charAt(3)] : 0), r = [K(i >>> 16), K(i >>> 8 & 255), K(255 & i)]; r.length -= [0, 0, 2, 1][n]; return r.join(""); }, Z = function (e) { return function (e) { return e.replace(/[\s\S]{1,4}/g, Q); }(e).replace(W, z); }, $ = function (e, t) { return t ? B(String(e)).replace(/[+\/]/g, (function (e) { return "+" == e ? "-" : "_"; })).replace(/=/g, "") : B(String(e)); }, ee = function (e) { return Z(String(e).replace(/[-_]/g, (function (e) { return "-" == e ? "+" : "/"; })).replace(/[^A-Za-z0-9\+\/]/g, "")); };
    var te = new function () { var e = "", t = this; this.set = function (t) { e = t; }; this.get = function () { return e; }; this.getImpObj = function () { return I(ee(e)); }; this.getItem = function (e) { var n = t.getImpObj(); return n && n[e] || ""; }; this.load = function () { e = O().get(f.IMPRINT); }; this.save = function () { e && O().set(f.IMPRINT, e); }; };
    function ne(e, n, i, r) { R.instance().setIdType(v().getIdType()); R.instance().setIdTracking(v().getIdTracking()); var o = v().getUserId(); o && e.analytics && (e.analytics.active_user = { puid: o, provider: v().getProvider() }); var s = l.clone(R.instance().get()); e.header = l.assign(s, e.header, { ts: Date.now(), testToken: G(), traceId: l.getRandomStr(10) + Date.now() + l.getRandomStr(9) }); var u = function (e) { return { h: j(e.header, L), a: x(e.analytics, C) }; }(e), c = S(u), p = { url: f.ENDPOINT + f.LOG_URL, method: "POST", data: $(c), success: function (r) { var o = r.code || r.status || r.statusCode; if (200 === o || 413 === o) {
            t().i("数据发送成功: ", e, c);
            !function (e) { if (e) {
                R.instance().setItem(f.IMPRINT, e);
                te.set(e);
                te.save();
                t().v("imprint: ", te.getImpObj());
                te.getItem("ttn_invalid") && (q = "");
            } }((r.data || {}).imprint);
            "function" == typeof n && n(r);
        }
        else {
            t().w("数据发送失败: ", c);
            "function" == typeof i && i();
        } }, fail: function (e) { t().w("超时: ", c); "function" == typeof i && i(); }, complete: function () { "function" == typeof r && r(); } }; a.request(l.assign(p, { header: { "content-type": "text/plain", "Msg-Type": a.getSdkType() + "/json" } })); }
    function ie(e) { var t = e, n = []; this.enqueue = function (e) { "number" == typeof t && this.size() >= t && this.dequeue(); n.push(e); }; this.dequeue = function () { return n.shift(); }; this.front = function () { return n[0]; }; this.isEmpty = function () { return 0 === n.length; }; this.clear = function () { n.length = 0; }; this.size = function () { return n.length; }; this.items = function () { return n; }; this.print = function () { console.log(n.toString()); }; }
    var re = function () { var e = null, n = !1, i = [], r = new ie(50); function o(e, t, n) { if (R.instance().isLoaded()) {
        t = t || {};
        var i = P(e);
        if (i) {
            var s = R.instance().getRealtimeFields();
            i.header = l.assign({}, i.header, s);
            i.noCache = t.noCache;
            r.enqueue(i);
        }
        "function" == typeof n && n();
    }
    else
        setTimeout((function () { o(e, t, n); }), 100); } function s(e) { var t = r.front(); if (t)
        ne(t, (function () { r.dequeue(); s(e); }), (function () { var t = r.dequeue(); t && !t.noCache && i.push(t); s(e); }));
    else {
        !function () { i.forEach((function (e) { r.enqueue(e); })); i.length = 0; }();
        e();
    } } function a(e) { if (v().getId())
        if (n)
            t().i("队列正在发送中");
        else {
            n = !0;
            s((function () { n = !1; "function" == typeof e && e(); }));
        }
    else {
        t().i("获取id标识失败，暂缓发送");
        "function" == typeof e && e();
    } } function u() { this.send = function (e, t, n) { e ? this.add(e, t, (function () { a(n); })) : a(n); }; this.add = function (e, t, n) { o(e, t, n); }; this.load = function () { var e = O().get(f.REQUESTS); e && e.length && e.forEach((function (e) { r.enqueue(e); })); O().remove(f.REQUESTS); }; this.save = function () { O().set(f.REQUESTS, l.clone(r.items())); r.clear(); }; } return function () { e || (e = new u); return e; }; }(), oe = function () { var e = null, i = null; function r() { this.setUserInfo = function (e) { i = e; }; this.update = function () { e(i) || a.getUserInfo((function (t) { e(t); })); }; function e(e) { if (e && "object" == typeof e) {
        var i = O().get(f.USER_INFO);
        i && l.deepEqual(e, i) || function (e, i) { var r = n().appKey(), o = a.getSdkType(), s = v().getId(), u = v().getIdType(); if (!(r && o && s && u))
            return; var c = { ak: n().appKey(), sdt: a.getSdkType(), uin: e.nickName, uia: e.avatar || e.avatarUrl, uig: e.gender, uit: e.country, uip: e.province, uic: e.city, uil: e.language, id: v().getId(), it: v().getIdType(), age: e.age, cln: e.constellation }, p = JSON.stringify(c); p = $(p); a.request({ url: f.ENDPOINT + f.USERINFO_URL, method: "POST", header: { "content-type": "application/x-www-form-urlencoded" }, data: "ui=" + p, success: function (n) { t().v("用户信息上传成功: ", e); i && i(n && n.data && 200 === n.data.code); }, fail: function () { t().e("用户信息上传失败: ", e); i && i(!1); } }); }(e, (function (t) { t && O().set(f.USER_INFO, e); }));
        return !0;
    } return !1; } } return function () { e || (e = new r); return e; }; }();
    function se(e, t) { this.id = e; this.ts = Date.now(); var n = typeof t; if ("string" === n && t)
        this[e] = t;
    else if ("object" === n)
        for (var i in t)
            ({}).hasOwnProperty.call(t, i) && (this[i] = t[i]); }
    function ae() { var e = !1, i = !1, r = 0; this.init = function (i) { t().v("sdk version: " + f.IMPL_VERSION); e ? t().v("Lib重复实例化") : O().load((function () { t().v("cache初始化成功: ", O().getAll()); !function () { v().setUseOpenid && v().setUseOpenid(n().useOpenid()); v().init((function () { R.instance().init(); t().v("Header初始化成功"); })); }(); e = !0; "function" == typeof i && i(); t().tip("SDK集成成功"); })); }; this.resume = function (r) { if (e && !i) {
        t().v("showOptions: ", r);
        var o;
        i = !0;
        n().enableVerify() && r && r.query && (o = r.query._ttn, q = o || q);
        this._resume(r);
    } }; this._resume = function (e) { re().load(); var i = U().resume(e), r = U().getCurrentSessionId(); E().setSessionId(r); i && re().add(k, {}, (function () { v().setUseOpenid && v().setUseOpenid(n().useOpenid()); if (n().useOpenid() && n().autoGetOpenid() && !v().getId()) {
        t().v("get id async");
        o(10, 3e3);
    }
    else {
        t().v("session auto send");
        re().send();
    } })); function o(e, i) { v().getId() || e <= 0 || v().getOpenIdAsync(n().appKey(), (function (n) { if (n) {
        t().v("获取id成功");
        re().send();
    }
    else {
        t().v("获取openid失败,启动重试,剩余可用次数", e - 1);
        setTimeout((function () { o(e - 1, i); }), i);
    } })); } }; this.pause = function (o) { if (e) {
        i = !1;
        r = 0;
        U().pause();
        n().uploadUserInfo() && oe().update();
        re().send(b, {}, (function () { re().save(); O().save(); t().v("cache save success"); "function" == typeof o && o(); }));
    } }; this.setOpenid = function (e) { t().v("setOpenId: %s", e); v().setOpenid(e); re().send(); }; this.setUnionid = function (e) { t().v("setUnionid: %s", e); v().setUnionid(e); }; this.setUserid = function (e, n) { t().v("setUserid: %s", e, n); v().setUserid(e, n); }; this.setUserInfo = function (e) { t().v("setUserInfo: %s", e); oe().setUserInfo(e); }; this.setAnonymousid = function (e) { t().v("setAnonymousId: %s", e); v().setAnonymousid(e); re().send(); }; this.setAppVersion = function (e) { e && "string" != typeof e ? t().w("setAppVersion方法只接受字符串类型参数") : R.instance().setAppVersion(e); }; this.setAlipayUserid = function (e) { if (e && "string" != typeof e)
        t().w("setAlipayUserid方法只接受字符串类型参数");
    else {
        t().v("setAlipayUserid: %s", e);
        v().setAlipayUserid(e);
    } }; this.setDeviceId = function (e) { if ("string" == typeof e) {
        v().setDeviceId(e);
        return e;
    } }; this.setSuperProperty = function (e) { if (e && "string" != typeof e)
        t().w("超级属性只支持字符串类型");
    else {
        var n = this;
        if (R.instance().getSuperProperty() !== e) {
            R.instance().setSuperProperty(e);
            n.pause((function () { n.resume(); }));
        }
    } }; this.trackEvent = function (n, i) { if (e) {
        t().v("event: ", n, i);
        if (function (e, n) { if (!e || "string" != typeof e) {
            t().e('please check trackEvent id. id should be "string" and not null');
            return !1;
        } var i = ["id", "ts", "du"], r = {}; i.forEach((function (e) { r[e] = 1; })); if (r[e]) {
            t().e("eventId不能与以下保留字冲突: " + i.join(","));
            return !1;
        } if (e.length > f.MAX_EVENTID_LENGTH) {
            t().e("The maximum length of event id shall not exceed " + f.MAX_EVENTID_LENGTH);
            return !1;
        } if (n && ("object" != typeof n || Array.isArray(n)) && "string" != typeof n) {
            t().e("please check trackEvent properties. properties should be string or object(not include Array)");
            return !1;
        } if ("object" == typeof n) {
            var o = 0;
            for (var s in n)
                if ({}.hasOwnProperty.call(n, s)) {
                    if (s.length > f.MAX_PROPERTY_KEY_LENGTH) {
                        t().e("The maximum length of property key shall not exceed " + f.MAX_PROPERTY_KEY_LENGTH);
                        return !1;
                    }
                    if (o >= f.MAX_PROPERTY_KEYS_COUNT) {
                        t().e("The maximum count of properties shall not exceed " + f.MAX_PROPERTY_KEYS_COUNT);
                        return !1;
                    }
                    if (r[s]) {
                        t().e("属性中的key不能与以下保留字冲突: " + i.join(","));
                        return !1;
                    }
                    o += 1;
                }
        } return !0; }(n, i)) {
            var o = new se(n, i);
            E().addEvent(o);
            var s = !!G(), a = s ? 0 : f.EVENT_SEND_DEFAULT_INTERVAL, u = Date.now();
            if (function (e, t) { return "number" != typeof r || "number" != typeof t || r <= 0 || e - r > t; }(u, a)) {
                r = u;
                re().send(D, { noCache: s }, (function () { }));
            }
        }
    } }; this.trackShare = function (n) { if (e)
        try {
            if (a.getSdkType().indexOf("game") > -1) {
                n = m().add(n, !0);
                t().v("shareQuery: ", n);
            }
            else {
                n = m().add(n, !1);
                t().v("sharePath: ", n.path);
            }
        }
        catch (e) {
            t().v("shareAppMessage: ", e);
        } return n; }; this.trackPageStart = function (t) { e && _().addPageStart(t); }; this.trackPageEnd = function (t) { e && _().addPageEnd(t); }; this.onShareAppMessage = function (e) { var t = this; a.onShareAppMessage((function () { return t.trackShare(e()); })); }; this.shareAppMessage = function (e) { this.trackShare(e); a.shareAppMessage(e); }; }
    var ue = [];
    function ce() { }
    ce.prototype = { createMethod: function (e, n, i) { try {
            e[n] = i && i[n] ? function () { return i[n].apply(i, arguments); } : function () { ue.push([n, [].slice.call(arguments)]); };
        }
        catch (e) {
            t().v("create method errror: ", e);
        } }, installApi: function (e, n) { try {
            var i, r, o = "resume,pause,trackEvent,trackPageStart,trackPageEnd,trackShare,setUserid,setOpenid,setUnionid,onShareAppMessage,shareAppMessage,setUserInfo".split(",");
            for (i = 0, r = o.length; i < r; i++)
                this.createMethod(e, o[i], n);
            if (n)
                for (i = 0, r = ue.length; i < r; i++) {
                    var s = ue[i];
                    try {
                        n[s[0]].apply(n, s[1]);
                    }
                    catch (e) {
                        t().v("impl[v[0]].apply error: ", s[0], e);
                    }
                }
        }
        catch (e) {
            t().v("install api errror: ", e);
        } } };
    var fe = [f.ENDPOINT, f.ENDPOINTB];
    function pe(e, n) { var i, r; 0 === e || 1 === e && n ? i = f.ENDPOINT : 2 === e && n ? i = f.ENDPOINTB : n && (i = fe[e]); if (e >= fe.length || n) {
        n && (r = i, f.ENDPOINT = r);
        n && t().v("命中可用服务", i);
        !n && t().tip_w("未命中可用服务");
        return !1;
    } a.request({ url: f.ENDPOINT + "/uminiprogram_logs/ckdh", success: function (t) { 200 === (t.code || t.status || t.statusCode) && t.data && 200 === t.data.code ? pe(e + 1, !0) : pe(e + 1, !1); }, fail: function () { pe(e + 1, !1); } }); }
    ({ init: function (e) { f.ENDPOINTB && setTimeout((function () { pe(0, !1); }), e); } }).init(3e3);
    var le = new ce, de = { _inited: !1, _log: t(), preinit: function (e) { if (e && "object" == typeof e)
            for (var t in e)
                f[t] = e[t]; return f; }, use: function (e, t) { e && l.isFunction(e.install) ? e.install(de, t) : l.isFunction(e) && e(de, t); return de; }, messager: r, init: function (e) { if (this._inited)
            t().v("已经实例过，请避免重复初始化");
        else if (e)
            if (e.appKey) {
                "boolean" != typeof e.useOpenid && (e.useOpenid = !0);
                n().set(e);
                t().setDebug(e.debug);
                this._inited = !0;
                var i = this;
                r.emit(r.messageType.CONFIG_LOADED, e);
                try {
                    var o = new ae;
                    t().v("成功创建Lib对象");
                    o.init((function () { t().v("Lib对象初始化成功"); le.installApi(i, o); t().v("安装Lib接口成功"); r.emit(r.messageType.UMA_LIB_INITED, e); }));
                }
                catch (e) {
                    t().w("创建Lib对象异常: " + e);
                }
            }
            else
                t().err("请确保传入正确的appkey");
        else
            t().err("请正确设置相关信息！"); } };
    try {
        le.installApi(de, null);
    }
    catch (e) {
        t().w("uma赋值异常: ", e);
    }
    var he = "https://ucc.umeng.com/v1/mini/fetch", ge = "https://pslog.umeng.com/mini_ablog", ve = "2.7.1", _e = "none", ye = {}, me = Array.isArray;
    ye.isArray = me || function (e) { return "[object Array]" === toString.call(e); };
    ye.isObject = function (e) { return e === Object(e) && !ye.isArray(e); };
    ye.isEmptyObject = function (e) { if (ye.isObject(e)) {
        for (var t in e)
            if (hasOwnProperty.call(e, t))
                return !1;
        return !0;
    } return !1; };
    ye.isUndefined = function (e) { return void 0 === e; };
    ye.isString = function (e) { return "[object String]" === toString.call(e); };
    ye.isDate = function (e) { return "[object Date]" === toString.call(e); };
    ye.isNumber = function (e) { return "[object Number]" === toString.call(e); };
    ye.each = function (e, t, n) { if (null != e) {
        var i = {}, r = Array.prototype.forEach;
        if (r && e.forEach === r)
            e.forEach(t, n);
        else if (e.length === +e.length) {
            for (var o = 0, s = e.length; o < s; o++)
                if (o in e && t.call(n, e[o], o, e) === i)
                    return;
        }
        else
            for (var a in e)
                if (hasOwnProperty.call(e, a) && t.call(n, e[a], a, e) === i)
                    return;
    } };
    ye.buildQuery = function (e, t) { var n, i, r = []; void 0 === t && (t = "&"); ye.each(e, (function (e, t) { n = encodeURIComponent(e.toString()); i = encodeURIComponent(t); r[r.length] = i + "=" + n; })); return r.join(t); };
    ye.JSONDecode = function (e) { if (e) {
        try {
            return JSON.parse(e);
        }
        catch (e) {
            console.error("JSONDecode error", e);
        }
        return null;
    } };
    ye.JSONEncode = function (e) { try {
        return JSON.stringify(e);
    }
    catch (e) {
        console.error("JSONEncode error", e);
    } };
    var Se = Object.create(null);
    function Ie(e) { t().v("开始构建 fetch body"); a.getSystemInfo((function (t) { a.getNetworkInfo((function (i) { var r = (i = i || {}).networkType; r = r === _e ? "unknown" : r.toUpperCase(); Se.access = r; !function (e, t) { var i = e.brand || ""; Se.deviceType = "Phone"; Se.sdkVersion = ve; Se.appkey = n().appKey(); Se.sdkType = a.getSdkType(); Se.umid = v().getId(); if (e) {
        Se.language = e.language || "";
        Se.os = e.OS;
        Se.osVersion = e.OSVersion;
        Se.deviceName = e.deviceName;
        Se.platformVersion = e.platformVersion;
        Se.platformSdkVersion = e.platformSDKVersion;
        Se.deviceBrand = i;
        var r = e.resolution.split("*");
        if (ye.isArray(r)) {
            Se.resolutionHeight = Number(r[0]);
            Se.resolutionWidth = Number(r[1]);
        }
    } !function (e) { if (e) {
        Se.installTime = e.install_datetime && Date.parse(e.install_datetime);
        Se.scene = e.install_scene;
        Se.channel = e.install_channel;
        Se.campaign = e.install_campaign;
    } }(te.getImpObj()); t && t(Se); }(t, e); })); })); }
    var Oe = Object.create(null), Ee = null, Te = !1, Ne = { minFetchIntervalSeconds: 43200 };
    function Ae(e) { e && ye.each(e, (function (e) { Oe[e.k] = e; })); }
    function ke() { var e = this; this.STORAGE_NAME = null; r.once(r.messageType.CONFIG_LOADED, (function (n) { t().v("云配初始化开始..."); e.init(n); })); }
    ke.prototype = { setDefaultValues: function (e) { Te && ye.isObject(e) && ye.each(e, (function (e, t) { Oe[t] && Oe[t].v || (Oe[t] = { v: e }); })); }, getValue: function (e) { t().v("从配置项中读取 value, 当前配置为: ", Oe); t().v("待读取的 key : ", e); try {
            if (!Te)
                return;
            var i = Oe[e] || {};
            t().v("读取相应配置ing..., 结果为: ", i);
            if (ye.isNumber(i.e) && ye.isNumber(i.g)) {
                t().v("读取到相应配置, 开始数据上报...");
                !function (e) { var i = { appkey: n().appKey(), sdkType: a.getSdkType(), expId: e && e.e, groupId: e && e.g, clientTs: Date.now(), key: e && e.k, value: e && e.v, umid: v().getId() }; try {
                    a.request({ url: ge, method: "POST", data: [i], success: function (e) { e && 200 === e.statusCode ? t().v("上传数据成功", i) : t().w("ablog 请求成功, 返回结果异常 ", e); }, fail: function (e) { t().w("ablog 请求数据错误 ", i, e); } });
                }
                catch (e) {
                    t().w("urequest 调用错误", e);
                } }(i);
            }
            return i.v;
        }
        catch (n) {
            t().w("getValue error, key: ", e);
        } }, active: function (e) { try {
            if (!Te)
                return;
            var n, i;
            e && e.params && (n = e.params);
            e && e.callback && (i = e.callback);
            t().v("激活配置项: ", n);
            if (n) {
                t().v("本地已缓存的配置项: ", Oe);
                Ae(n);
                t().v("合并后的配置项: ", Oe);
                i && i(Oe);
                t().v("active 结束");
            }
            else {
                t().v("配置项为空!! 读取本地配置...");
                a.getStorage(this.STORAGE_NAME, (function (e) { if (e) {
                    Ae((e = ye.JSONDecode(e) || {}).params);
                    t().v("当前本地配置项为: ", Oe);
                    i && i(Oe);
                    t().v("active 结束");
                }
                else
                    t().v("当前本地配置项为空, 退出激活"); }));
            }
        }
        catch (e) {
            t().w("SDK active 错误", e);
        } }, init: function (e) { if (e.appKey) {
            Ee = e.appKey;
            this.STORAGE_NAME = "um_remote_config_{{" + Ee + "}}";
        } if (Ee)
            if (Te)
                t().w("SDK 已经初始化, 请避免重复初始化");
            else {
                Te = !0;
                this.setOptions(e);
                this.active();
            }
        else
            t().err("请检查您的小程序 appKey, appKey 不能为空"); }, setOptions: function (e) { if (ye.isObject(e)) {
            var t = e.minFetchIntervalSeconds;
            ye.isNumber(t) && (Ne.minFetchIntervalSeconds = Math.max(t, 5));
        } }, fetch: function (e) { if (Te && this.STORAGE_NAME) {
            var n, i;
            e && e.active && (n = e.active);
            e && e.callback && (i = e.callback);
            var r = this;
            a.getStorage(this.STORAGE_NAME, (function (e) { t().v("开始读缓存 data is ", e); if ((e = ye.JSONDecode(e) || {}).params && e.ts && Date.now() - e.ts < 1e3 * Ne.minFetchIntervalSeconds) {
                t().v("缓存数据存在, 并且本次触发时间距离上次fetch触发时间未超过 fetch 时间间隔, 无需 fetch");
                i && i(e.params);
            }
            else
                Ie((function (e) { t().v("缓存数据不存在, 构建 fetch body :", e); try {
                    a.request({ url: he, method: "POST", data: e, success: function (e) { if (e && 200 === e.statusCode && e.data && e.data.cc) {
                            t().v("fetch 请求成功, 响应数据: ", e.data);
                            var o = Object.create(null);
                            ye.each(e.data.cc, (function (e) { o[e.k] = e; }));
                            var s = { ts: Date.now(), params: o };
                            t().v("开始缓存 fetch 请求的云配置结果...");
                            a.setStorage(r.STORAGE_NAME, ye.JSONEncode(s), (function (e) { t().v("缓存云配置成功, 缓存数据为: ", s); t().v("缓存云配置成功, 成功消息为: ", e); t().v("云配拉取数据是否自动激活: ", n); if (e && n) {
                                t().v("激活云配置...");
                                r.active({ params: o, callback: i });
                            } }));
                        }
                        else {
                            t().w("fetch 请求成功,返回结果异常 ", e.data);
                            i && i();
                        } }, fail: function (n) { t().w("fetch请求数据错误 ", e, n); i && i(); } });
                }
                catch (e) {
                    t().w("urequest调用错误", e);
                } })); }));
        } } };
    var be = { install: function (e, t) { e.rc || (e.rc = new ke); e.messager.once(e.messager.messageType.CONFIG_LOADED, (function () { e._log.v("plugin rc installed"); })); return e.rc; } }, De = "_um", we = "revenue", Re = "stage", Ue = "level", Pe = "running", Ce = "end", Le = "init", Me = "set", je = [De, Re, "start"].join(".");
    function Ve(e) { var t = {}; for (var n in e) {
        var i = e[n];
        if ("object" == typeof i)
            for (var r in i)
                t[n + "." + r] = i[r];
        else
            t[n] = i;
    } return t; }
    var xe = { install: function (e, t) { e.revenue = function (t) { e.trackEvent([De, we, t.group].join("."), Ve(t)); }; var n = 0; e.stage = { onStart: function (t) { n = Date.now(); e.trackEvent(je, Ve(t)); }, onEnd: function (t) { "number" != typeof t._um_sdu && (t._um_sdu = 0 !== n ? Date.now() - n : 0); e.trackEvent([De, Re, Ce, t.event].join("."), Ve(t)); }, onRunning: function (t) { e.trackEvent([De, Re, Pe, t.event].join("."), Ve(t)); } }; e.level = { onInitLevel: function (t) { e.trackEvent([De, Ue, Le].join("."), Ve(t)); }, onSetLevel: function (t) { e.trackEvent([De, Ue, Me].join("."), Ve(t)); } }; e.messager.once(e.messager.messageType.CONFIG_LOADED, (function () { e._log.v("plugin game-ext installed"); })); return e; } }, qe = a.getContext();
    qe.onShow((function (e) { t().v("game onShow: ", e); n = e.query, y = n; var n; de.resume(e, !0); }));
    qe.onHide((function () { t().v("game onHide"); de.pause(); }));
    var Ge = de.init;
    de.init = function (e) { if (e && e.useOpenid) {
        t().tip_w(t().repeat("!"));
        t().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取");
        t().tip_w(t().repeat("!"));
    } de.resume({}); Ge.call(de, e); };
    de.use(be);
    de.use(xe);
    qe.uma = de;
    console.log("qg uma");
    console.log(qg.uma);
}
else if (window['tt'] != null && window['tt'] != undefined) {
    /*不能用 有问题获取不到sessionid
        "use strict";var t="[UMENG] -- ",e=function(){var e=null,n=!1;function i(){this.setDebug=function(t){n=t};this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.debug.apply(console,arguments)}catch(t){}};this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.info.apply(console,arguments)}catch(t){}}catch(t){}};this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.error.apply(console,arguments)}catch(t){}};this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.warn.apply(console,arguments)}catch(t){}};this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.log.apply(console,arguments)}catch(t){}};this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(t){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.log.apply(console,arguments)}catch(t){}};this.tip_w=function(t){try{console.log("%c [UMENG] -- "+t,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(t){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=t+arguments[0]);console.error.apply(console,arguments)}catch(t){}};this.repeat=function(t){for(var e=t;e.length<86;)e+=t;return e}}return function(){null===e&&(e=new i);return e}}(),n=function(){var t=null;function e(){var t={};this.useOpenid=function(){return!!t.useOpenid};this.useSwanid=function(){return!!t.useSwanid};this.autoGetOpenid=function(){return!!t.autoGetOpenid};this.appKey=function(){return t.appKey};this.uploadUserInfo=function(){return t.uploadUserInfo};this.enableVerify=function(){return t.enableVerify};this.set=function(e){t=e};this.get=function(){return t};this.setItem=function(e,n){t[e]=n};this.getItem=function(e){return t[e]}}return function(){t||(t=new e);return t}}();function i(){}i.prototype={on:function(t,e,n){var i=this.e||(this.e={});(i[t]||(i[t]=[])).push({fn:e,ctx:n});return this},once:function(t,e,n){var i=this;function r(){i.off(t,r);e.apply(n,arguments)}r._=e;return this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var o=0,s=i.length;o<s;o++)i[o].fn!==e&&i[o].fn._!==e&&r.push(i[o]);r.length?n[t]=r:delete n[t];return this}};var r=new i;r.messageType={CONFIG_LOADED:0,UMA_LIB_INITED:1};var o=function(t,e){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return o(t,e)};function s(t,e){o(t,e);function n(){this.constructor=t}t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=new(function(t){s(e,t);function e(){return null!==t&&t.apply(this,arguments)||this}e.prototype.getSdkType=function(){return"ttgamemp"};return e}(function(){function t(){}t.prototype.setStorage=function(t,n,i){tt.setStorage({key:t,data:n,success:function(t){"function"==typeof i&&i(!0)},fail:function(n){e().w(t+": "+n.errMsg);"function"==typeof i&&i(!1)}})};t.prototype.getStorage=function(t,n){tt.getStorage({key:t,success:function(t){"function"==typeof n&&n(t.data)},fail:function(i){e().w(t+": "+i.errMsg);"function"==typeof n&&n()}})};t.prototype.removeStorage=function(t,e){tt.removeStorage({key:t,success:function(){"function"==typeof e&&e(!0)},fail:function(){"function"==typeof e&&e(!1)}})};t.prototype.getSystemInfo=function(t){tt.getSystemInfo({success:function(e){e.safeArea=e.safeArea||{};var n={model:e.model,brand:e.brand,pixelRatio:e.pixelRatio,screenWidth:e.screenWidth,screenHeight:e.screenHeight,fontSizeSetting:e.fontSizeSetting,platform:e.platform,platformVersion:e.version,platformSDKVersion:e.SDKVersion,language:e.language,deviceName:e.model,safeArea:{width:e.safeArea.width,height:e.safeArea.height,top:e.safeArea.top,left:e.safeArea.left,bottom:e.safeArea.bottom,right:e.safeArea.right},statusBarHeight:e.statusBarHeight,host:e.appName},i=e.system.split(" ");if(Array.isArray(i)){n.OS=i[0];n.OSVersion=i[1]}var r=Math.round(e.screenWidth*e.pixelRatio),o=Math.round(e.screenHeight*e.pixelRatio);n.resolution=r>o?r+"*"+o:o+"*"+r;"function"==typeof t&&t(n)},fail:function(){"function"==typeof t&&t()}})};t.prototype.getDeviceInfo=function(t){"function"==typeof t&&t()};t.prototype.checkNetworkAvailable=function(t){tt.getNetworkType({success:function(e){"function"==typeof t&&t(e&&"none"!==e.networkType)},fail:function(){"function"==typeof t&&t()}})};t.prototype.getNetworkInfo=function(t){tt.getNetworkType({success:function(e){"function"==typeof t&&t(e)},fail:function(){"function"==typeof t&&t()}})};t.prototype.onNetworkStatusChange=function(t){tt.onNetworkStatusChange((function(e){"function"==typeof t&&t("none"!==e.networkType)}))};t.prototype.request=function(t){var e=(t=t||{}).success,n=t.fail||function(){},i=!1,r=null;t.success=function(t){if(!i){r&&clearTimeout(r);"function"==typeof e&&e(t)}};t.fail=function(){if(!i){r&&clearTimeout(r);"function"==typeof n&&n()}};tt.request(t);r=setTimeout((function(){r&&clearTimeout(r);i=!0;"function"==typeof n&&n(i)}),t.timeout||5e3)};t.prototype.getDeviceId=function(t){t("")};t.prototype.getAdvertisingId=function(t){"function"==typeof t&&t("")};t.prototype.getSdkType=function(){return"ttmp"};t.prototype.getPlatform=function(){return"tt"};t.prototype.getUserInfo=function(t){var n={fail:function(){t&&t()},success:function(e){try{var n=e.userInfo;n&&t&&t({avatar:n.avatarUrl,nickName:n.nickName,gender:n.gender,country:n.country,province:n.province,city:n.city,language:n.language})}catch(e){t&&t()}}};try{tt.getSetting({success:function(t){t.authSetting["scope.userInfo"]&&tt.getUserInfo(n)},fail:function(){t&&t()}})}catch(t){e.e("getUserInfo error",t)}};t.prototype.getAppInfoSync=function(){return{}};t.prototype.onShareAppMessage=function(t){tt.onShareAppMessage(t)};t.prototype.shareAppMessage=function(t){tt.shareAppMessage(t)};t.prototype.getLaunchOptionsSync=function(){var t=null;if(t)return t;if(!tt.getLaunchOptionsSync)return{};try{t=tt.getLaunchOptionsSync()}catch(e){t=null}return t||{}};return t}())),u={SESSION_INTERVAL:3e4,LOG_URL:"/bytedancem_logs",GET_OPENID_URL:"/uminiprogram_logs/bytedance/getuut",USERINFO_URL:"/uminiprogram_logs/comm/uif",ENDPOINT:"https://umini.shujupie.com",ENDPOINTB:"https://ulogs.umeng.com",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.7.2",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",SWANID:"um_swanid",ANONYMOUSID:"um_anonymousid",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1};var c={isNumber:function(t){return!Number.isNaN(parseInt(t,10))},compareVersion:function(t,e){for(var n=String(t).split("."),i=String(e).split("."),r=0;r<Math.max(n.length,i.length);r++){var o=parseInt(n[r]||0,10),s=parseInt(i[r]||0,10);if(o>s)return 1;if(o<s)return-1}return 0},getRandomStr:function(t){for(var e="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(t);i++){e+=n[Math.round(Math.random()*(n.length-1))]}return e},clone:function(t){return JSON.parse(JSON.stringify(t))},startsWith:function(t,e){return!(!t||!e||0===e.length||e.length>t.length)&&t.substr(0,e.length)===e},endsWith:function(t,e){return!(!e||0===t.length||e.length>t.length)&&t.substring(t.length-e.length)===e},assign:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},deepEqual:function t(e,n){if(e===n)return!0;if(e&&"object"==typeof e&&n&&"object"==typeof n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e){if(Object.prototype.hasOwnProperty.call(n,i))return!1;if(!t(e[i],n[i]))return!1}return!0}return!1},trimStart:function(t,e){if(!t)return"";if("string"==typeof e&&e.length){var n=new RegExp("^"+e+"*");t=t.replace(n,"")}else t=t.replace(/^s*!/,"");return t},trimEnd:function(t,e){if(!t)return"";var n,i;if("string"==typeof e&&e.length){n=new RegExp(e);i=t.length;for(;n.test(t.charAt(i));)i-=1;return t.slice(0,i+1)}n=/s/;i=t.length-1;for(;n.test(t.charAt(i));)i-=1;return t.slice(0,i+1)},isFunction:function(t){return"function"==typeof t}},f=function(){function t(){this._uuid="";this._userid="";this._provider="";this._idType=""}t.prototype.createUUID=function(){return c.getRandomStr(10)+Date.now()+c.getRandomStr(7)+u.UUID_SUFFIX};t.prototype.initUUID=function(t){var e=this;a.getStorage(u.UUID,(function(n){if(n)e._uuid=n;else{e._uuid=e.createUUID();a.setStorage(u.UUID,e._uuid)}t&&t(n)}))};t.prototype.initUserid=function(){var t=this;a.getStorage(u.USERID,(function(n){if(!t._userid&&n){t._userid=n;e().v("userId is ",n)}}));a.getStorage(u.PROVIDER,(function(n){if(!t._provider&&n){t._provider=n;e().v("provider is ",n)}}))};t.prototype.init=function(t){var e=this;e.initUUID((function(){e.initUserid();e.initID(t)}))};t.prototype.setUserid=function(t,e){if(!this._userid&&t){this._userid=t;this._provider=e;a.setStorage(u.USERID,t);a.setStorage(u.PROVIDER,e)}};t.prototype.removeUserid=function(){this._userid=void 0;this._provider=void 0;a.removeStorageSync(u.USERID);a.removeStorageSync(u.PROVIDER)};t.prototype.getUserId=function(){return this._userid};t.prototype.getProvider=function(){return this._provider};t.prototype.getIdType=function(){return this._idType};t.prototype.getIdTracking=function(){var t={};this._uuid&&(t.uuid=this._uuid);this._userid&&(t.userid=this._userid);return t};return t}();!function(t){s(n,t);function n(){var e=null!==t&&t.apply(this,arguments)||this;e._openid="";e._unionid="";e._useOpenid=!1;return e}n.prototype.initID=function(t){var n=this;n._idType=n._useOpenid?"openid":"uuid";e().v("id type: ",n._idType);a.getStorage(u.UNIONID,(function(t){n._unionid=t}));this._useOpenid?a.getStorage(u.OPENID,(function(e){n._openid=e;t&&t()})):t&&t()};n.prototype.setUseOpenid=function(t){this._useOpenid=t};n.prototype.setOpenid=function(t){if(!this._openid&&t){this._openid=t;a.setStorage(u.OPENID,t)}};n.prototype.setUnionid=function(t){if(!this._unionid&&t){this._unionid=t;a.setStorage(u.UNIONID,t)}};n.prototype.getIdTracking=function(){var e=t.prototype.getIdTracking.call(this);this._openid&&(e.openid=this._openid);this._unionid&&(e.unionid=this._unionid);this._userid&&(e.userid=this._userid);return e};n.prototype.getId=function(){return this._useOpenid?this._openid:this._uuid}}(f);var p,d=function(t){s(n,t);function n(){var e=null!==t&&t.apply(this,arguments)||this;e._unionid="";e._openid="";e._anonymousid="";e._useOpenid=!1;return e}n.prototype.getOpenIdAsync=function(t,n){var i=this;tt.login({force:!1,success:function(r){r?a.request({url:u.ENDPOINT+u.GET_OPENID_URL,method:"GET",data:{key:t,code:r.code||"",anonymous_code:r.anonymousCode||""},success:function(t){e().v("tt request ss ",t,u.ENDPOINT+u.GET_OPENID_URL);if(t&&200===t.statusCode&&t.data&&t.data.data){var r=t.data.data;i.setOpenid(r.oid);i.setAnonymousid(r.nid);return n&&n(!0)}n&&n()},fail:function(t){e().v("tt request failed...",t);n&&n()}}):n&&n()},fail:function(t){e().v("tt login failed...",t);n&&n()}})};n.prototype.initID=function(t){var n=this;n._idType="anonymousid";e().v("id type: ",n._idType);a.getStorage(u.OPENID,(function(t){n._openid=t}));a.getStorage(u.ANONYMOUSID,(function(e){n._anonymousid=e;t&&t()}))};n.prototype.setUseOpenid=function(t){this._useOpenid=t};n.prototype.setOpenid=function(t){if(!this._openid&&t){this._openid=t;a.setStorage(u.OPENID,t)}};n.prototype.setAnonymousid=function(t){if(!this._anonymousid&&t){this._anonymousid=t;a.setStorage(u.ANONYMOUSID,t)}};n.prototype.getIdTracking=function(){var e=t.prototype.getIdTracking.call(this);this._openid&&(e.openid=this._openid);this._userid&&(e.userid=this._userid);this._anonymousid&&(e.anonymousid=this._anonymousid);return e};n.prototype.getId=function(){if(this._anonymousid){this._idType="anonymousid";return this._anonymousid}};return n}(f),l=(p=null,function(){p||(p=new d);return p}),h=function(){var t=null;function e(){var t=!1,e=null,n=[];this.addPageStart=function(n){if(n&&!t){e={ts:Date.now(),path:n,page_name:n};t=!0}};this.addPageEnd=function(i){if(t&&i&&e&&i===e.page_name){var r=Date.now()-e.ts;e.duration=Math.abs(r);n.push(e);e=null;t=!1}};this.get=function(){return n};this.getCurrentPage=function(){return e};this.clear=function(){n.length=0}}return function(){t||(t=new e);return t}}(),g={};var v=function(){var t=null,n=[],i="";function r(){return{add:function(t,r){e().v("share origin: %o",t);var o={title:t&&t.title,path:t&&t.path&&t.path.split("?")[0],_um_sts:Date.now()};o.path&&o.path.length>1&&c.startsWith(o.path,"/")&&(o.path=c.trimStart(o.path,"/"));var s=t.path||"",a=l().getId();if(a){var u=i.split(","),f=(u=u.filter((function(t){return t.length>0}))).indexOf(a);f>=0&&(u=u.slice(0,f));u.length<3&&u.push(a);var p=u.join(",");-1!==s.indexOf("?")?s+="&_um_ssrc="+p:s+="?_um_ssrc="+p;var d=Date.now();s+="&_um_sts="+d;if(r){var h=function(t){var e=[];for(var n in t)"_um_ssrc"!==n&&"_um_sts"!==n&&e.push(n+"="+t[n]);return e.join("&")}(g),v=h?h+"&_um_ssrc="+p+"&_um_sts="+d:"_um_ssrc="+p+"&_um_sts="+d;t.query=t.query?t.query+"&_um_ssrc="+p+"&_um_sts="+d:v}else t.path=s;o._um_ssrc=p;o._um_sts=d}n.push(o);e().v("share: %o",t);return t},setShareSource:function(t){i=t},clear:function(){n.length=0},get:function(){return n}}}return function(){t||(t=new r);return t}}(),_=function(t){if(t)try{return JSON.stringify(t)}catch(t){}return""},y=function(t){if(t)try{return JSON.parse(t)}catch(t){}return null},m=function(){var t=null,e="",i=null,r=!1;function o(){this.load=function(t){if(i){a.removeStorage(e);t()}else{e="um_cache_"+n().appKey();a.getStorage(e,(function(n){i=y(n)||{};r=!0;a.removeStorage(e);t()}))}};this.save=function(){i&&a.setStorage(e,_(i))};this.set=function(t,e){i&&(i[t]=e)};this.get=function(t){return(i||{})[t]};this.remove=function(t){i&&i[t]&&delete i[t]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(t){return!!this.get(t)};this.isLoaded=function(){return r}}return function(){t||(t=new o);return t}}(),S=function(){var t,n,i=[],r=[];function o(){if(i.length){var t=m().get("ekvs");if(function(t){var e=0;for(var n in t)Array.isArray(t[n])&&(e+=t[n].length);return e}(t)+i.length<=1e4){t=s(t,i);m().set("ekvs",t)}}}function s(t,e){var i=(t=t||{})[n];Array.isArray(i)&&i.length?t[n]=i.concat(e):t[n]=[].concat(e);return t}return function(){t||(t={addEvent:function(t){if(n){i.unshift(t);if(i.length>1){o();i.length=0}}else{e().w("session id is null: ",n);r.unshift(t)}},setSessionId:function(t){n=t;e().v("setSessionId: ",n);if(Array.isArray(r)&&r.length&&n){for(var i=0;i<r.length;i++)this.addEvent(r[i]);r.length=0}},getEkvs:function(){var t=m().get("ekvs");i&&i.length&&(t=s(t,i));return t},clear:function(){m().remove("ekvs");i.length=0}});return t}}(),I="2g",O="3g",E="4g",A="half_session",N="close_session",T="ekv",k=["access","access_subtype"],D=function(){var t=null;function e(){var t=!1,e={};function i(t){var i=m().get(u.IMPRINT);i&&(e.imprint=i);e.device_type="Phone";e.sdk_version=u.IMPL_VERSION;e.appkey=n().appKey();a.getDeviceInfo((function(t){e.device_info=t||""}));var r=a.getAppInfoSync();e.appid=r.appId;e.app_env=r.appEnv;e.app_version=r.appVersion;a.getSystemInfo((function(n){a.getNetworkInfo((function(i){var r=function(t,e){var n={};(t=t||{}).safeArea=t.safeArea||{};var i=(e=e||{}).networkType;"none"===i&&(i="unknown");var r=t.model||"",o=t.platform||"",s=t.brand||"",u=s.toLowerCase();n.sdk_type=a.getSdkType();n.platform=a.getPlatform();n.platform_sdk_version=t.platformSDKVersion;n.platform_version=t.platformVersion;n.resolution=t.resolution;n.pixel_ratio=t.pixelRatio;n.os=o;n.font_size_setting=t.fontSizeSetting;n.device_model=r;n.device_brand=s;n.device_manufacturer=u;n.device_manuid=r;n.device_name=r;n.os_version=t.OSVersion;n.language=t.language;n.theme=t.theme;n.benchmark_level=t.benchmarkLevel;n.status_bar_height=t.statusBarHeight;n.safe_area_top=t.safeArea.top;n.safe_area_left=t.safeArea.left;n.safe_area_right=t.safeArea.right;n.safe_area_bottom=t.safeArea.bottom;n.safe_area_height=t.safeArea.height;n.safe_area_width=t.safeArea.width;n.storage=t.storage;n.screen_width=t.screenWidth;n.screen_height=t.screenHeight;n.host=t.host;switch(i=i?i.toLowerCase():""){case E:n.access_subtype="LTE";n.access="4G";break;case O:n.access_subtype="CDMA";n.access="3G";break;case I:n.access_subtype="GRPS";n.access="2G";break;default:n.access=i;delete n.access_subtype}return n}(n,i);c.assign(e,r);t&&t()}))}))}return{init:function(){i((function(){t=!0}))},isLoaded:function(){return t},get:function(){return e},getRealtimeFields:function(){var t={};k.forEach((function(n){t[n]=e[n]}));return t},setIdTracking:function(t){this.setItem("id_tracking",t)},setIdType:function(t){this.setItem("id_type",t)},setAppVersion:function(t){this.setItem("app_version",t)},setSuperProperty:function(t){e.sp||(e.sp={});e.sp.isv=t},getSuperProperty:function(){return e&&e.sp?e.sp.isv:""},setItem:function(t,n){e[t]=n},getItem:function(t){return e[t]}}}return{instance:function(){t||(t=e());return t}}}(),b=function(){var t=null,n=null,i=null;function r(){return{resume:function(t){var r=!1;i||(i=m().get(u.CURRENT_SESSION));var o=new Date;n=o.getTime();if(!i||!i.end_time||n-i.end_time>u.SESSION_INTERVAL){r=!0;!function(t){try{var n=(i||{}).options||{},r=c.assign({},function(t){var n={};for(var i in t)0===i.indexOf("_um_")&&(n[i]=t[i]);e().v("query: ",t);e().v("_um_params: ",n);return n}(t.query));r.path=t.path||n.path;"gaode"!==a.getPlatform()&&(r.scene=t.scene?a.getPlatform()+"_"+t.scene:n.scene);var o=t.referrerInfo;o&&(r.referrerAppId=o.appId);e().v("session options: ",r);var s=r[u.UM_SSRC];s&&v().setShareSource(s);var f=Date.now();i={id:c.getRandomStr(10)+f,start_time:f,options:r}}catch(t){e().e("生成新session失败: ",t)}}(t);e().v("开始新的session(%s): ",i.id,i)}else e().v("延续上一次session(%s): %s ",i.id,o.toLocaleTimeString(),i);return r},pause:function(){!function(){if(i){var t=new Date;i.end_time=t.getTime();"number"!=typeof i.duration&&(i.duration=0);i.duration=i.end_time-n;m().set(u.CURRENT_SESSION,i);e().v("退出会话(%s): %s ",i.id,t.toLocaleTimeString(),i)}}()},getCurrentSessionId:function(){return(i||{}).id},getCurrentSession:function(){return i},cloneCurrentSession:function(){return c.clone(i)}}}return function(){t||(t=r());return t}}();function w(t){var e=null;switch(t){case A:e=function(){var t=null,e=b().cloneCurrentSession();e&&(t={header:{st:"1"},analytics:{sessions:[e]}});return t}();break;case N:e=function(){var t=null,e={},n=b().cloneCurrentSession();if(n){var i=h().get(),r=v().get();Array.isArray(i)&&i.length&&(n.pages=c.clone(i));Array.isArray(r)&&r.length&&(n.shares=c.clone(r));h().clear();v().clear();e.sessions=[n]}var o=S().getEkvs();if(o){e.ekvs=c.clone(o);S().clear()}(e.sessions||e.ekvs)&&(t={analytics:e});return t}();break;case T:e=function(){var t=null,e=S().getEkvs();if(e){t={analytics:{ekvs:c.clone(e)}};S().clear()}return t}()}return e}var U={sessions:"sn",ekvs:"e",active_user:"active_user"},R={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn",theme:"t5",benchmark_level:"bml",screen_width:"sw",screen_height:"sh",status_bar_height:"sbh",safe_area_top:"sat",safe_area_left:"sal",safe_area_right:"sar",safe_area_bottom:"sab",safe_area_height:"sah",safe_area_width:"saw",pixel_ratio:"pr",storage:"s7",host:"hs"},P={uuid:"ud",unionid:"und",openid:"od",anonymousid:"nd",alipay_id:"ad",device_id:"dd",userid:"puid"};function C(t,e){var n=L(t,e);t&&t.id_tracking&&(n[e.id_tracking||"id_tracking"]=L(t.id_tracking,P));return n}function L(t,e){var n={};for(var i in t)e[i]?n[e[i]]=t[i]:n[i]=t[i];return n}function M(t,e){var n={};if(t)for(var i in t)t[i]&&(n[e[i]]=t[i]);return n}var j="";function V(){return j}var G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",x=function(t){for(var e={},n=0,i=t.length;n<i;n++)e[t.charAt(n)]=n;return e}(G),F=String.fromCharCode,q=function(t){if(t.length<2){return(e=t.charCodeAt(0))<128?t:e<2048?F(192|e>>>6)+F(128|63&e):F(224|e>>>12&15)+F(128|e>>>6&63)+F(128|63&e)}var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return F(240|e>>>18&7)+F(128|e>>>12&63)+F(128|e>>>6&63)+F(128|63&e)},K=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,H=function(t){var e=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[G.charAt(n>>>18),G.charAt(n>>>12&63),e>=2?"=":G.charAt(n>>>6&63),e>=1?"=":G.charAt(63&n)].join("")},Y=function(t){return e=function(t){return t.replace(K,q)}(t),e.replace(/[\s\S]{1,3}/g,H);var e},J=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),B=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return F(55296+(e>>>10))+F(56320+(1023&e));case 3:return F((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return F((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},X=function(t){var e=t.length,n=e%4,i=(e>0?x[t.charAt(0)]<<18:0)|(e>1?x[t.charAt(1)]<<12:0)|(e>2?x[t.charAt(2)]<<6:0)|(e>3?x[t.charAt(3)]:0),r=[F(i>>>16),F(i>>>8&255),F(255&i)];r.length-=[0,0,2,1][n];return r.join("")},W=function(t){return e=function(t){return t.replace(/[\s\S]{1,4}/g,X)}(t),e.replace(J,B);var e},z=function(t,e){return e?Y(String(t)).replace(/[+\/]/g,(function(t){return"+"==t?"-":"_"})).replace(/=/g,""):Y(String(t))},Q=function(t){return W(String(t).replace(/[-_]/g,(function(t){return"-"==t?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))};var Z=new function(){var t="",e=this;this.set=function(e){t=e};this.get=function(){return t};this.getImpObj=function(){return y(Q(t))};this.getItem=function(t){var n=e.getImpObj();return n&&n[t]||""};this.load=function(){t=m().get(u.IMPRINT)};this.save=function(){t&&m().set(u.IMPRINT,t)}};function $(t,n,i,r){D.instance().setIdType(l().getIdType());D.instance().setIdTracking(l().getIdTracking());var o=l().getUserId();o&&t.analytics&&(t.analytics.active_user={puid:o,provider:l().getProvider()});var s=c.clone(D.instance().get());t.header=c.assign(s,t.header,{ts:Date.now(),testToken:V(),traceId:c.getRandomStr(10)+Date.now()+c.getRandomStr(9)});var f,p=function(t){return{h:C(t.header,R),a:M(t.analytics,U)}}(t),d=_(p),h={url:u.ENDPOINT+u.LOG_URL,method:"POST",data:z(d),success:function(r){var o=r.code||r.status||r.statusCode;if(200===o||413===o){e().i("数据发送成功: ",t,d);!function(t){if(t){D.instance().setItem(u.IMPRINT,t);Z.set(t);Z.save();e().v("imprint: ",Z.getImpObj());Z.getItem("ttn_invalid")&&(j="")}}((r.data||{}).imprint);"function"==typeof n&&n(r)}else{e().w("数据发送失败: ",d);"function"==typeof i&&i()}},fail:function(t){e().w("超时: ",d);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};a.request(c.assign(h,{header:{"Content-Type":f=a.getSdkType()+"/json","Msg-Type":f}}))}function et(t){var e=t,n=[];this.enqueue=function(t){"number"==typeof e&&this.size()>=e&&this.dequeue();n.push(t)};this.dequeue=function(){return n.shift()};this.front=function(){return n[0]};this.isEmpty=function(){return 0===n.length};this.clear=function(){n.length=0};this.size=function(){return n.length};this.items=function(){return n};this.print=function(){console.log(n.toString())}}var nt=function(){var t=null,n=!1,i=[],r=new et(50);function o(t,e,n){if(D.instance().isLoaded()){e=e||{};var i=w(t);if(i){var s=D.instance().getRealtimeFields();i.header=c.assign({},i.header,s);i.noCache=e.noCache;r.enqueue(i)}"function"==typeof n&&n()}else setTimeout((function(){o(t,e,n)}),100)}function s(t){var e=r.front();if(e)$(e,(function(){r.dequeue();s(t)}),(function(){var e=r.dequeue();e&&!e.noCache&&i.push(e);s(t)}));else{!function(){i.forEach((function(t){r.enqueue(t)}));i.length=0}();t()}}function a(t){if(l().getId())if(n)e().i("队列正在发送中");else{n=!0;s((function(){n=!1;"function"==typeof t&&t()}))}else{e().i("获取id标识失败，暂缓发送");"function"==typeof t&&t()}}function f(){this.send=function(t,e,n){t?this.add(t,e,(function(){a(n)})):a(n)};this.add=function(t,e,n){o(t,e,n)};this.load=function(){var t=m().get(u.REQUESTS);t&&t.length&&t.forEach((function(t){r.enqueue(t)}));m().remove(u.REQUESTS)};this.save=function(){m().set(u.REQUESTS,c.clone(r.items()));r.clear()}}return function(){t||(t=new f);return t}}(),it=function(){var t=null,i=null;function r(){this.setUserInfo=function(t){i=t};this.update=function(){t(i)||a.getUserInfo((function(e){t(e)}))};function t(t){if(t&&"object"==typeof t){var i=m().get(u.USER_INFO);i&&c.deepEqual(t,i)||function(t,i){var r=n().appKey(),o=a.getSdkType(),s=l().getId(),c=l().getIdType();if(!(r&&o&&s&&c))return;var f={ak:n().appKey(),sdt:a.getSdkType(),uin:t.nickName,uia:t.avatar||t.avatarUrl,uig:t.gender,uit:t.country,uip:t.province,uic:t.city,uil:t.language,id:l().getId(),it:l().getIdType(),age:t.age,cln:t.constellation},p=JSON.stringify(f);p=z(p);a.request({url:u.ENDPOINT+u.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+p,success:function(n){e().v("用户信息上传成功: ",t);i&&i(n&&n.data&&200===n.data.code)},fail:function(){e().e("用户信息上传失败: ",t);i&&i(!1)}})}(t,(function(e){e&&m().set(u.USER_INFO,t)}));return!0}return!1}}return function(){t||(t=new r);return t}}();function rt(t,e){this.id=t;this.ts=Date.now();var n=typeof e;if("string"===n&&e)this[t]=e;else if("object"===n)for(var i in e)({}).hasOwnProperty.call(e,i)&&(this[i]=e[i])}function ot(){var t=!1,i=!1,r=0;this.init=function(i){e().v("sdk version: "+u.IMPL_VERSION);t?e().v("Lib重复实例化"):m().load((function(){e().v("cache初始化成功: ",m().getAll());!function(){l().setUseOpenid&&l().setUseOpenid(n().useOpenid());l().init((function(){D.instance().init();e().v("Header初始化成功")}))}();t=!0;"function"==typeof i&&i();e().tip("SDK集成成功")}))};this.resume=function(r){if(t&&!i){e().v("showOptions: ",r);var o;i=!0;n().enableVerify()&&r&&r.query&&(o=r.query._ttn,j=o||j);this._resume(r)}};this._resume=function(t){nt().load();var i=b().resume(t),r=b().getCurrentSessionId();S().setSessionId(r);i&&nt().add(A,{},(function(){l().setUseOpenid&&l().setUseOpenid(n().useOpenid());if(n().useOpenid()&&n().autoGetOpenid()&&!l().getId()){e().v("get id async");o(10,3e3)}else{e().v("session auto send");nt().send()}}));function o(t,i){l().getId()||t<=0||l().getOpenIdAsync(n().appKey(),(function(n){if(n){e().v("获取id成功");nt().send()}else{e().v("获取openid失败,启动重试,剩余可用次数",t-1);setTimeout((function(){o(t-1,i)}),i)}}))}};this.pause=function(o){if(t){i=!1;r=0;b().pause();n().uploadUserInfo()&&it().update();nt().send(N,{},(function(){nt().save();m().save();e().v("cache save success");"function"==typeof o&&o()}))}};this.setOpenid=function(t){e().v("setOpenId: %s",t);l().setOpenid(t);nt().send()};this.setUnionid=function(t){e().v("setUnionid: %s",t);l().setUnionid(t)};this.setUserid=function(t,n){e().v("setUserid: %s",t,n);l().setUserid(t,n)};this.removeUserid=function(){e().v("removeUserid");l().removeUserid()};this.setUserInfo=function(t){e().v("setUserInfo: %s",t);it().setUserInfo(t)};this.setAnonymousid=function(t){e().v("setAnonymousId: %s",t);l().setAnonymousid(t);nt().send()};this.setAppVersion=function(t){t&&"string"!=typeof t?e().w("setAppVersion方法只接受字符串类型参数"):D.instance().setAppVersion(t)};this.setAlipayUserid=function(t){if(t&&"string"!=typeof t)e().w("setAlipayUserid方法只接受字符串类型参数");else{e().v("setAlipayUserid: %s",t);l().setAlipayUserid(t)}};this.setDeviceId=function(t){if("string"==typeof t){l().setDeviceId(t);return t}};this.setSuperProperty=function(t){if(t&&"string"!=typeof t)e().w("超级属性只支持字符串类型");else{var n=this;if(D.instance().getSuperProperty()!==t){D.instance().setSuperProperty(t);n.pause((function(){n.resume()}))}}};this.trackEvent=function(n,i){if(t){e().v("event: ",n,i);if(function(t,n){if(!t||"string"!=typeof t){e().e('please check trackEvent id. id should be "string" and not null');return!1}var i=["id","ts","du"],r={};i.forEach((function(t){r[t]=1}));if(r[t]){e().e("eventId不能与以下保留字冲突: "+i.join(","));return!1}if(t.length>u.MAX_EVENTID_LENGTH){e().e("The maximum length of event id shall not exceed "+u.MAX_EVENTID_LENGTH);return!1}if(n&&("object"!=typeof n||Array.isArray(n))&&"string"!=typeof n){e().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof n){var o=0;for(var s in n)if({}.hasOwnProperty.call(n,s)){if(s.length>u.MAX_PROPERTY_KEY_LENGTH){e().e("The maximum length of property key shall not exceed "+u.MAX_PROPERTY_KEY_LENGTH);return!1}if(o>=u.MAX_PROPERTY_KEYS_COUNT){e().e("The maximum count of properties shall not exceed "+u.MAX_PROPERTY_KEYS_COUNT);return!1}if(r[s]){e().e("属性中的key不能与以下保留字冲突: "+i.join(","));return!1}o+=1}}return!0}(n,i)){var o=new rt(n,i);S().addEvent(o);var s=!!V(),a=s?0:u.EVENT_SEND_DEFAULT_INTERVAL,c=Date.now();if(function(t,e){return"number"!=typeof r||"number"!=typeof e||r<=0||t-r>e}(c,a)){r=c;nt().send(T,{noCache:s},(function(){}))}}}};this.trackShare=function(n){if(t)try{if(a.getSdkType().indexOf("game")>-1){n=v().add(n,!0);e().v("shareQuery: ",n)}else{n=v().add(n,!1);e().v("sharePath: ",n.path)}}catch(t){e().v("shareAppMessage: ",t)}return n};this.trackPageStart=function(e){t&&h().addPageStart(e)};this.trackPageEnd=function(e){t&&h().addPageEnd(e)};this.onShareAppMessage=function(t){var e=this;a.onShareAppMessage((function(){return e.trackShare(t())}))};this.shareAppMessage=function(t){this.trackShare(t);a.shareAppMessage(t)}}var st=[];function at(){}at.prototype={createMethod:function(t,n,i){try{t[n]=i&&i[n]?function(){return i[n].apply(i,arguments)}:function(){st.push([n,[].slice.call(arguments)])}}catch(t){e().v("create method errror: ",t)}},installApi:function(t,n){try{var i,r,o="resume,pause,trackEvent,trackPageStart,trackPageEnd,trackShare,setUserid,setOpenid,setAnonymousid,onShareAppMessage,shareAppMessage".split(",");for(i=0,r=o.length;i<r;i++)this.createMethod(t,o[i],n);if(n)for(i=0,r=st.length;i<r;i++){var s=st[i];try{n[s[0]].apply(n,s[1])}catch(t){e().v("impl[v[0]].apply error: ",s[0],t)}}}catch(t){e().v("install api errror: ",t)}}};var ut=[u.ENDPOINT,u.ENDPOINTB];function ct(t,n){var i,r;0===t||1===t&&n?i=u.ENDPOINT:2===t&&n?i=u.ENDPOINTB:n&&(i=ut[t]);if(t>=ut.length||n){n&&(r=i,u.ENDPOINT=r);n&&e().v("命中可用服务",i);!n&&e().tip_w("未命中可用服务");return!1}a.request({url:u.ENDPOINT+"/uminiprogram_logs/ckdh",success:function(e){200===(e.code||e.status||e.statusCode)&&e.data&&200===e.data.code?ct(t+1,!0):ct(t+1,!1)},fail:function(){ct(t+1,!1)}})}var ft={init:function(t){u.ENDPOINTB&&setTimeout((function(){ct(0,!1)}),t)}},pt=new at,dt={_inited:!1,_log:e(),preinit:function(t){if(t&&"object"==typeof t)for(var e in t)u[e]=t[e];return u},use:function(t,e){t&&c.isFunction(t.install)?t.install(dt,e):c.isFunction(t)&&t(dt,e);return dt},messager:r,init:function(t){if(this._inited)e().v("已经实例过，请避免重复初始化");else if(t)if(t.appKey){"boolean"!=typeof t.useOpenid&&(t.useOpenid=!0);n().set(t);e().setDebug(t.debug);this._inited=!0;var i=this;r.emit(r.messageType.CONFIG_LOADED,t);try{var o=new ot;e().v("成功创建Lib对象");0;o.init((function(){e().v("Lib对象初始化成功");pt.installApi(i,o);e().v("安装Lib接口成功");r.emit(r.messageType.UMA_LIB_INITED,t)}));ft.init(3e3)}catch(t){e().w("创建Lib对象异常: "+t)}}else e().err("请确保传入正确的appkey");else e().err("请正确设置相关信息！")}};try{pt.installApi(dt,null)}catch(t){e().w("uma赋值异常: ",t)}var lt="https://ucc.umeng.com/v1/mini/fetch",ht="https://pslog.umeng.com/mini_ablog",gt="2.7.2",vt="none",_t={},yt=Array.isArray;_t.isArray=yt||function(t){return"[object Array]"===toString.call(t)};_t.isObject=function(t){return t===Object(t)&&!_t.isArray(t)};_t.isEmptyObject=function(t){if(_t.isObject(t)){for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0}return!1};_t.isUndefined=function(t){return void 0===t};_t.isString=function(t){return"[object String]"===toString.call(t)};_t.isDate=function(t){return"[object Date]"===toString.call(t)};_t.isNumber=function(t){return"[object Number]"===toString.call(t)};_t.each=function(t,e,n){if(null!=t){var i={},r=Array.prototype.forEach;if(r&&t.forEach===r)t.forEach(e,n);else if(t.length===+t.length){for(var o=0,s=t.length;o<s;o++)if(o in t&&e.call(n,t[o],o,t)===i)return}else for(var a in t)if(hasOwnProperty.call(t,a)&&e.call(n,t[a],a,t)===i)return}};_t.buildQuery=function(t,e){var n,i,r=[];void 0===e&&(e="&");_t.each(t,(function(t,e){n=encodeURIComponent(t.toString());i=encodeURIComponent(e);r[r.length]=i+"="+n}));return r.join(e)};_t.JSONDecode=function(t){if(t){try{return JSON.parse(t)}catch(t){console.error("JSONDecode error",t)}return null}};_t.JSONEncode=function(t){try{return JSON.stringify(t)}catch(t){console.error("JSONEncode error",t)}};var mt=Object.create(null);function St(t){e().v("开始构建 fetch body");a.getSystemInfo((function(e){a.getNetworkInfo((function(i){var r=(i=i||{}).networkType;r=r===vt?"unknown":r.toUpperCase();mt.access=r;!function(t,e){var i=t.brand||"";mt.deviceType="Phone";mt.sdkVersion=gt;mt.appkey=n().appKey();mt.sdkType=a.getSdkType();mt.umid=l().getId();if(t){mt.language=t.language||"";mt.os=t.OS;mt.osVersion=t.OSVersion;mt.deviceName=t.deviceName;mt.platformVersion=t.platformVersion;mt.platformSdkVersion=t.platformSDKVersion;mt.deviceBrand=i;var r=t.resolution.split("*");if(_t.isArray(r)){mt.resolutionHeight=Number(r[0]);mt.resolutionWidth=Number(r[1])}}!function(t){if(t){mt.installTime=t.install_datetime&&Date.parse(t.install_datetime);mt.scene=t.install_scene;mt.channel=t.install_channel;mt.campaign=t.install_campaign}}(Z.getImpObj());e&&e(mt)}(e,t)}))}))}var It=Object.create(null),Ot=null,Et=!1,At={minFetchIntervalSeconds:43200};function Nt(t){t&&_t.each(t,(function(t){It[t.k]=t}))}function Tt(){var t=this;this.STORAGE_NAME=null;r.once(r.messageType.CONFIG_LOADED,(function(n){e().v("云配初始化开始...");t.init(n)}))}Tt.prototype={setDefaultValues:function(t){Et&&_t.isObject(t)&&_t.each(t,(function(t,e){It[e]&&It[e].v||(It[e]={v:t})}))},getValue:function(t){e().v("从配置项中读取 value, 当前配置为: ",It);e().v("待读取的 key : ",t);try{if(!Et)return;var i=It[t]||{};e().v("读取相应配置ing..., 结果为: ",i);if(_t.isNumber(i.e)&&_t.isNumber(i.g)){e().v("读取到相应配置, 开始数据上报...");!function(t){var i={appkey:n().appKey(),sdkType:a.getSdkType(),expId:t&&t.e,groupId:t&&t.g,clientTs:Date.now(),key:t&&t.k,value:t&&t.v,umid:l().getId()};try{a.request({url:ht,method:"POST",data:[i],success:function(t){t&&200===t.statusCode?e().v("上传数据成功",i):e().w("ablog 请求成功, 返回结果异常 ",t)},fail:function(t){e().w("ablog 请求数据错误 ",i,t)}})}catch(t){e().w("urequest 调用错误",t)}}(i)}return i.v}catch(n){e().w("getValue error, key: ",t)}},active:function(t){try{if(!Et)return;var n,i;t&&t.params&&(n=t.params);t&&t.callback&&(i=t.callback);e().v("激活配置项: ",n);if(n){e().v("本地已缓存的配置项: ",It);Nt(n);e().v("合并后的配置项: ",It);i&&i(It);e().v("active 结束")}else{e().v("配置项为空!! 读取本地配置...");a.getStorage(this.STORAGE_NAME,(function(t){if(t){Nt((t=_t.JSONDecode(t)||{}).params);e().v("当前本地配置项为: ",It);i&&i(It);e().v("active 结束")}else e().v("当前本地配置项为空, 退出激活")}))}}catch(t){e().w("SDK active 错误",t)}},init:function(t){if(t.appKey){Ot=t.appKey;this.STORAGE_NAME="um_remote_config_{{"+Ot+"}}"}if(Ot)if(Et)e().w("SDK 已经初始化, 请避免重复初始化");else{Et=!0;this.setOptions(t);this.active()}else e().err("请检查您的小程序 appKey, appKey 不能为空")},setOptions:function(t){if(_t.isObject(t)){var e=t.minFetchIntervalSeconds;_t.isNumber(e)&&(At.minFetchIntervalSeconds=Math.max(e,5))}},fetch:function(t){if(Et&&this.STORAGE_NAME){var n,i;t&&t.active&&(n=t.active);t&&t.callback&&(i=t.callback);var r=this;a.getStorage(this.STORAGE_NAME,(function(t){e().v("开始读缓存 data is ",t);if((t=_t.JSONDecode(t)||{}).params&&t.ts&&Date.now()-t.ts<1e3*At.minFetchIntervalSeconds){e().v("缓存数据存在, 并且本次触发时间距离上次fetch触发时间未超过 fetch 时间间隔, 无需 fetch");i&&i(t.params)}else St((function(t){e().v("缓存数据不存在, 构建 fetch body :",t);try{a.request({url:lt,method:"POST",data:t,success:function(t){if(t&&200===t.statusCode&&t.data&&t.data.cc){e().v("fetch 请求成功, 响应数据: ",t.data);var o=Object.create(null);_t.each(t.data.cc,(function(t){o[t.k]=t}));var s={ts:Date.now(),params:o};e().v("开始缓存 fetch 请求的云配置结果...");a.setStorage(r.STORAGE_NAME,_t.JSONEncode(s),(function(t){e().v("缓存云配置成功, 缓存数据为: ",s);e().v("缓存云配置成功, 成功消息为: ",t);e().v("云配拉取数据是否自动激活: ",n);if(t&&n){e().v("激活云配置...");r.active({params:o,callback:i})}}))}else{e().w("fetch 请求成功,返回结果异常 ",t.data);i&&i()}},fail:function(n){e().w("fetch请求数据错误 ",t,n);i&&i()}})}catch(t){e().w("urequest调用错误",t)}}))}))}}};var kt={install:function(t,e){t.rc||(t.rc=new Tt);t.messager.once(t.messager.messageType.CONFIG_LOADED,(function(){t._log.v("plugin rc installed")}));return t.rc}},Dt="_um",bt="revenue",wt="stage",Ut="level",Rt="running",Pt="end",Ct="init",Lt="set",Mt=[Dt,wt,"start"].join(".");function jt(t){var e={};for(var n in t){var i=t[n];if("object"==typeof i)for(var r in i)e[n+"."+r]=i[r];else e[n]=i}return e}var Vt={install:function(t,e){t.revenue=function(e){t.trackEvent([Dt,bt,e.group].join("."),jt(e))};var n=0;t.stage={onStart:function(e){n=Date.now();t.trackEvent(Mt,jt(e))},onEnd:function(e){"number"!=typeof e._um_sdu&&(e._um_sdu=0!==n?Date.now()-n:0);t.trackEvent([Dt,wt,Pt,e.event].join("."),jt(e))},onRunning:function(e){t.trackEvent([Dt,wt,Rt,e.event].join("."),jt(e))}};t.level={onInitLevel:function(e){t.trackEvent([Dt,Ut,Ct].join("."),jt(e))},onSetLevel:function(e){t.trackEvent([Dt,Ut,Lt].join("."),jt(e))}};t.messager.once(t.messager.messageType.CONFIG_LOADED,(function(){t._log.v("plugin game-ext installed")}));return t}};tt.onShow((function(t){e().v("game onShow: ",t);n=t.query,g=n;var n;dt.resume(t,!0)}));tt.onHide((function(){e().v("game onHide");dt.pause()}));var Gt=dt.init;dt.init=function(t){if(t&&t.useOpenid){e().tip_w(e().repeat("!"));e().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取");e().tip_w(e().repeat("!"))}Gt.call(dt,t)};dt.use(kt);dt.use(Vt);tt.uma=dt;var de=dt;
    */
}
else {
    /*var de = null;
    if (window['qg']) window['qg'].uma = de;
    if (window['wx']) window['wx'].uma = de;
    if (window['tt']) window['tt'].uma = de;
    if (window['swan']) window['swan'].uma = de;
    if (window['qq']) window['qq'].uma = de;*/
}
console.log('de= ', de);
exports.default = de;
